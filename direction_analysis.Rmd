---
title: "ecosystem connectivity - direction analysis"
output: html_notebook
---

xx

```{r}
data <- read.csv("~/GitHub/Ecosystem_Connectivity/Data/all_studies.csv", header = TRUE)
```

ok first remove the excluded studies
```{r}
head(data)
colnames(data)
```
so the rows you want to exclude are under "Include..Y..N..M"

First you want to make this column is characters and not soome other wierd thing

```{r}
str(data$Include..Y..N..M) #its a factor with 8 levels...
data$Include..Y..N..M <- as.character(data$Include..Y..N..M)
```
ok now check for unique values (the responses may be in different formats)

```{r}
uniqueinc <- unique(data$Include..Y..N..M)
uniqueinc
```
ok so.. 
Y and y need to be merged to y
N and No and n and no need to be merged to n
M and R need to be merged to m

```{r}
data$Include..Y..N..M <- replace(data$Include..Y..N..M, data$Include..Y..N..M == "Y", "y")
data$Include..Y..N..M <- replace(data$Include..Y..N..M, data$Include..Y..N..M == "N", "n")
data$Include..Y..N..M <- replace(data$Include..Y..N..M, data$Include..Y..N..M == "No", "n")
data$Include..Y..N..M <- replace(data$Include..Y..N..M, data$Include..Y..N..M == "no", "n")
data$Include..Y..N..M <- replace(data$Include..Y..N..M, data$Include..Y..N..M == "R", "m")
data$Include..Y..N..M <- replace(data$Include..Y..N..M, data$Include..Y..N..M == "M", "m")
```
and recheck...
```{r}
uniqueinc <- unique(data$Include..Y..N..M)
uniqueinc
```
perfect

Now subset just to have all the y
```{r}
ydata <- data[data$Include..Y..N..M == "y",]
```
ok now out of interest count how many n there were
```{r}
library(plyr)
ynm <- count(data, 'Include..Y..N..M') 
ynm
```
and in the ydata (should be none)
```{r}
y <- count(ydata, 'Include..Y..N..M') 
y
```
great

ok save that ydata as a new .csv

```{r}
write.csv(ydata, file = "./data/all_yes_studies.csv", row.names = FALSE)
```


```{r}
colnames(ydata)
```

So you can remove..
"Include..Y..N..M"                                                                         
"If.excluding..reason.for.exclusion"  
 
```{r}
ydata <- subset(ydata, select = -c(Include..Y..N..M, If.excluding..reason.for.exclusion))
colnames(ydata)
```

ok now let's tidy each column...

[6] "From.original.search..Y.or.N" 
```{r}
ydata$From.original.search..Y.or.N <- as.character(ydata$From.original.search..Y.or.N) #make col as.character
orsea <- unique(ydata$From.original.search..Y.or.N)
orsea
```

and tidy...
```{r}
ydata$From.original.search..Y.or.N <- replace(ydata$From.original.search..Y.or.N, ydata$From.original.search..Y.or.N == "Y", "y") #all Y will be y
ydata$From.original.search..Y.or.N <- replace(ydata$From.original.search..Y.or.N, ydata$From.original.search..Y.or.N == "Y ", "y") #all Y will be y
ydata$From.original.search..Y.or.N <- replace(ydata$From.original.search..Y.or.N, ydata$From.original.search..Y.or.N == "N", "n") #all N will be n
```

and check
```{r}
orsea1 <- unique(ydata$From.original.search..Y.or.N)
orsea1
```

ok next column
 [7] "Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem"
```{r}
ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem <- as.character(ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem) #make col as.character
focus <- unique(ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem)
focus
```

and tidy...
```{r}
ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem <- replace(ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem, ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem == "Subsidy", "subsidy") 

ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem <- replace(ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem, ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem == "Both", "both")

ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem <- replace(ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem, ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem == "Community", "community")

ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem <- replace(ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem, ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem == "Subsidy & Community", "subsidy & community")

ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem <- replace(ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem, ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem == "community & subsidy", "subsidy & community")

ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem <- replace(ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem, ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem == "Subsidy and community", "subsidy & community")

ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem <- replace(ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem, ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem == "subsidy and community", "subsidy & community")

ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem <- replace(ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem, ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem == "", "subsidy") #i checked this
```

and check
```{r}
focus1 <- unique(ydata$Focus.on.subsidy..community..subsidy...community..or.subsidy...ecosystem)
focus1
```

next
[8] "Study.Type" 
```{r}
ydata$Study.Type <- as.character(ydata$Study.Type) #make col as.character
type <- unique(ydata$Study.Type)
type
```


and tidy...
```{r}
ydata$Study.Type <- replace(ydata$Study.Type, ydata$Study.Type == "Observational", "observational") 

ydata$Study.Type <- replace(ydata$Study.Type, ydata$Study.Type == "Manipulative", "manipulative") 

ydata$Study.Type <- replace(ydata$Study.Type, ydata$Study.Type == "Observational & experiment", "observational & experiment") 

ydata$Study.Type <- replace(ydata$Study.Type, ydata$Study.Type == "Modeling", "model")
                            
ydata$Study.Type <- replace(ydata$Study.Type, ydata$Study.Type == "Modelling", "model")
                            
ydata$Study.Type <- replace(ydata$Study.Type, ydata$Study.Type == "Laboratory", "lab")

ydata$Study.Type <- replace(ydata$Study.Type, ydata$Study.Type == "observational + laboratory", "observational + lab") 
                            
ydata$Study.Type <- replace(ydata$Study.Type, ydata$Study.Type == "observational + laboratory", "observational + lab")  

ydata$Study.Type <- replace(ydata$Study.Type, ydata$Study.Type == "Observational (but lab study completed too)", "observational + lab")                             

ydata$Study.Type <- replace(ydata$Study.Type, ydata$Study.Type == "Observational/modelling", "observational + model")

ydata$Study.Type <- replace(ydata$Study.Type, ydata$Study.Type == "Observational + Modelling", "observational + model")

ydata$Study.Type <- replace(ydata$Study.Type, ydata$Study.Type == "Observational + model", "observational + model")

ydata$Study.Type <- replace(ydata$Study.Type, ydata$Study.Type == "Observational + model", "observational + model")

ydata$Study.Type <- replace(ydata$Study.Type, ydata$Study.Type == "", "observational + manipulative") #i checked this

ydata$Study.Type <- replace(ydata$Study.Type, ydata$Study.Type == "observational & experiment", "observational + experiment") 

```

and check
```{r}
type1 <- unique(ydata$Study.Type)
type1
```

next..
[9] "Specific.Methodology.Used" 

```{r}
ydata$Specific.Methodology.Used <- as.character(ydata$Specific.Methodology.Used) #make col as.character
meth <- unique(ydata$Specific.Methodology.Used)
meth
```
eek ok lots here...but probably cant to doo much

and tidy...
```{r}
ydata$Specific.Methodology.Used <- replace(ydata$Specific.Methodology.Used, ydata$Specific.Methodology.Used == "Transects", "transects") 

ydata$Specific.Methodology.Used <- replace(ydata$Specific.Methodology.Used, ydata$Specific.Methodology.Used == "video transects", "transects")

ydata$Specific.Methodology.Used <- replace(ydata$Specific.Methodology.Used, ydata$Specific.Methodology.Used == "transect collections", "transects")

ydata$Specific.Methodology.Used <- replace(ydata$Specific.Methodology.Used, ydata$Specific.Methodology.Used == "transect", "transects")

ydata$Specific.Methodology.Used <- replace(ydata$Specific.Methodology.Used, ydata$Specific.Methodology.Used == "Quadrat sampling", "quadrat")

ydata$Specific.Methodology.Used <- replace(ydata$Specific.Methodology.Used, ydata$Specific.Methodology.Used == "quadrat sampling", "quadrat")

ydata$Specific.Methodology.Used <- replace(ydata$Specific.Methodology.Used, ydata$Specific.Methodology.Used == "quadrats laid on transects", "quadrat")

ydata$Specific.Methodology.Used <- replace(ydata$Specific.Methodology.Used, ydata$Specific.Methodology.Used == "transect with quadrat + invert sampling", "quadrat")

ydata$Specific.Methodology.Used <- replace(ydata$Specific.Methodology.Used, ydata$Specific.Methodology.Used == "quadrat surveys; morphological assessments of kelp", "quadrat")
  
ydata$Specific.Methodology.Used <- replace(ydata$Specific.Methodology.Used, ydata$Specific.Methodology.Used == "Sediment analysis", "sediment analysis")

ydata$Specific.Methodology.Used <- replace(ydata$Specific.Methodology.Used, ydata$Specific.Methodology.Used == "Nutrient analysis - water", "nutrient analysis")

ydata$Specific.Methodology.Used <- replace(ydata$Specific.Methodology.Used, ydata$Specific.Methodology.Used == "Isotope analysis", "stable isotope analysis")

ydata$Specific.Methodology.Used <- replace(ydata$Specific.Methodology.Used, ydata$Specific.Methodology.Used == "Stable Isotope Analysis", "stable isotope analysis")

ydata$Specific.Methodology.Used <- replace(ydata$Specific.Methodology.Used, ydata$Specific.Methodology.Used == "Stable isotope analysis", "stable isotope analysis")

ydata$Specific.Methodology.Used <- replace(ydata$Specific.Methodology.Used, ydata$Specific.Methodology.Used == "WATER sampling", "water sampling")

ydata$Specific.Methodology.Used <- replace(ydata$Specific.Methodology.Used, ydata$Specific.Methodology.Used == "water quality sampling", "water sampling")

ydata$Specific.Methodology.Used <- replace(ydata$Specific.Methodology.Used, ydata$Specific.Methodology.Used == "tagging of kelp", "tagging")

ydata$Specific.Methodology.Used <- replace(ydata$Specific.Methodology.Used, ydata$Specific.Methodology.Used == "Marking fish and monitoring movement", "tagging")

ydata$Specific.Methodology.Used <- replace(ydata$Specific.Methodology.Used, ydata$Specific.Methodology.Used == "", "quadrat") #i checked this one
```

and check
```{r}
meth1 <- unique(ydata$Specific.Methodology.Used)
meth1
```

ok leave like this as you don't know what tianna might want to pull...

next
[12] "Measured.variable.s...include.one.line.for.each.variable."                                
```{r}
ydata$Measured.variable.s...include.one.line.for.each.variable. <- as.character(ydata$Measured.variable.s...include.one.line.for.each.variable.) #make col as.character
meas <- unique(ydata$Measured.variable.s...include.one.line.for.each.variable.)
meas
```
again his could be tricky....

```{r}
ydata$Measured.variable.s...include.one.line.for.each.variable <- replace(ydata$Measured.variable.s...include.one.line.for.each.variable, ydata$Measured.variable.s...include.one.line.for.each.variable == "carbon:nitorgen ratio", "C:N ratios") 

ydata$Measured.variable.s...include.one.line.for.each.variable <- replace(ydata$Measured.variable.s...include.one.line.for.each.variable, ydata$Measured.variable.s...include.one.line.for.each.variable == "", "Stable isotope values") 

```

check
```{r}
meas1 <- unique(ydata$Measured.variable.s...include.one.line.for.each.variable.)
meas1
```


next
[11] "Unit.of.measured.variable"                                                                

```{r}
ydata$Unit.of.measured.variable <- as.character(ydata$Unit.of.measured.variable) #make col as.character
unit <- unique(ydata$Unit.of.measured.variable)
unit
```

```{r}
ydata$Unit.of.measured.variable <- replace(ydata$Unit.of.measured.variable, ydata$Unit.of.measured.variable == "number of fish", "count")

ydata$Unit.of.measured.variable <- replace(ydata$Unit.of.measured.variable, ydata$Unit.of.measured.variable == "Presence or absence", "presence/absence")
```


for the missing values, one should be 14C, 13C (study no 180)

find the row number for this value
```{r}
which(grepl(180, ydata$Study.number)) #find the value 180 in the column study.number
``` 

ok so it's row 133

and now the column is 11 

```{r}
ydata[113, 11] == "14C, 13C"
```

and check
```{r}
unit1 <- unique(ydata$Unit.of.measured.variable)
unit1
```


```{r}
uniquelocations <- unique(ydata$Study.location)
uniquelocations
```

ok lots of variation... we just want countries really... 
let's start by adding a new column called Country
```{r}
ydata$country <- format(as.character) #created a new column called country
colnames(ydata)
```
ok great... now need to figure out how to populate it...
lets start by populating with the locations as is
```{r}
ydata$country <- ydata$Study.location
ydata$country <- as.character(ydata$country)
head(ydata)
```
ok good now lets start replacing values so you only get country names

```{r}
ydata$country <- replace(ydata$country, ydata$country == "Western coast of Norway", "Norway")
ydata$country <- replace(ydata$country, ydata$country == "NW coast Spain", "Spain")
ydata$country <- replace(ydata$country, ydata$country == "SE Australia", "Australia")
ydata$country <- replace(ydata$country, ydata$country == "SE Argentina", "Argentina")
ydata$country <- replace(ydata$country, ydata$country == "NE Spain", "Spain")
ydata$country <- replace(ydata$country, ydata$country == "North Carolina, USA", "USA")
ydata$country <- replace(ydata$country, ydata$country == "South Australia", "Australia")
ydata$country <- replace(ydata$country, ydata$country == "South-west Australia", "Australia")
ydata$country <- replace(ydata$country, ydata$country == "SE Australia", "Australia")
ydata$country <- replace(ydata$country, ydata$country == "North Island, New Zealand", "New Zealand")
ydata$country <- replace(ydata$country, ydata$country == "British Columbia, Canada", "Canada")
ydata$country <- replace(ydata$country, ydata$country == "Nova Scotia, Canada", "Canada")
ydata$country <- replace(ydata$country, ydata$country == "Grosetto, Italy", "Italy")
ydata$country <- replace(ydata$country, ydata$country == "Central California", "USA")
ydata$country <- replace(ydata$country, ydata$country == "South west Australia", "Australia")
ydata$country <- replace(ydata$country, ydata$country == "Southeast US", "USA")
ydata$country <- replace(ydata$country, ydata$country == "Massachusetts, USA", "USA")
ydata$country <- replace(ydata$country, ydata$country == "Cape Breton Island, Nova Scotia", "Canada")
ydata$country <- replace(ydata$country, ydata$country == "Northwestern Vancouver Island, British Columbia", "Canada")
ydata$country <- replace(ydata$country, ydata$country == "Puget Sound, Washington, USA", "USA")
ydata$country <- replace(ydata$country, ydata$country == "NW Scotland", "Scotland")
ydata$country <- replace(ydata$country, ydata$country == "SW Australia", "Australia")
ydata$country <- replace(ydata$country, ydata$country == "Central Japan", "Japan")
ydata$country <- replace(ydata$country, ydata$country == "Eastern Germany, Baltic Sea", "Germany")
ydata$country <- replace(ydata$country, ydata$country == "Washington State, San Juan Archipelago", "USA")
ydata$country <- replace(ydata$country, ydata$country == "Southern California and Mexico", "Mexico and USA")
ydata$country <- replace(ydata$country, ydata$country == "Southern California and Southeast Spain", "USA and Spain")
ydata$country <- replace(ydata$country, ydata$country == "western Australia", "Australia")
ydata$country <- replace(ydata$country, ydata$country == "Western Australia", "Australia")
ydata$country <- replace(ydata$country, ydata$country == "Washington State, USA", "USA")
ydata$country <- replace(ydata$country, ydata$country == "West France", "France")
ydata$country <- replace(ydata$country, ydata$country == "Chesapeake Bay, USA", "USA")
ydata$country <- replace(ydata$country, ydata$country == "California, USA", "USA")
ydata$country <- replace(ydata$country, ydata$country == "New England, USA", "USA")
ydata$country <- replace(ydata$country, ydata$country == "Quebec ", "Canada")
ydata$country <- replace(ydata$country, ydata$country == "New York, USA", "USA")
ydata$country <- replace(ydata$country, ydata$country == "Washington State", "USA")
ydata$country <- replace(ydata$country, ydata$country == "canada", "Canada")

```
ok let's check...
```{r}
uniquecountry <- unique(ydata$country)
uniquecountry
```
ok so there are still some issues...
USA and Spain
Baltic Sea
NW Mediteranean (Balearic basin)
Sea of Okhotsk, Western Pacific Ocean
France + UK
Northwestern mediterranean
Mexico and USA
Northern Balearic Island
""
Meditteranean

First lets count how many unique studies there are in each country... https://stackoverflow.com/questions/12840294/counting-unique-distinct-values-by-group-in-a-data-frame/12848190

```{r}
library(plyr)
countrycount <- ddply(ydata,~country,summarise,country_count=length(unique(Authors)))
countrycount

```
soo the counts for our trouble locations are...

USA and Spain - 1 x
Baltic Sea - 1
NW Mediteranean (Balearic basin) - 1
Sea of Okhotsk, Western Pacific Ocean - 1
France + UK - 1 x
Northwestern mediterranean - 1
Mexico and USA - 1 x
Northern Balearic Island - 1
"" - 2
Meditteranean - 1

Ok soo all but the missing country studies have only one - this makes it a little easier
For those joint country studies, lets just add 1 value to each individual country, and then remove the joint country entry


```{r}
countrycount$country_count[countrycount$country == "USA"] = countrycount$country_count[countrycount$country == "USA"] +1
countrycount$country_count[countrycount$country == "Spain"] = countrycount$country_count[countrycount$country == "Spain"] +1
countrycount <- countrycount[!(countrycount$country == "USA and Spain"), ]
countrycount$country_count[countrycount$country == "USA"] = countrycount$country_count[countrycount$country == "USA"] +1
countrycount$country_count[countrycount$country == "Mexico"] = countrycount$country_count[countrycount$country == "Mexico"] +1
countrycount <- countrycount[!(countrycount$country == "Mexico and USA"), ]
countrycount$country_count[countrycount$country == "France"] = countrycount$country_count[countrycount$country == "France"] +1
countrycount$country_count[countrycount$country == "UK"] = countrycount$country_count[countrycount$country == "UK"] +1
countrycount <- countrycount[!(countrycount$country == "France + UK"), ]
countrycount

```

ok so now left is those that i need to go look at the papers...

Baltic Sea - 1
NW Mediteranean (Balearic basin) - 1
Sea of Okhotsk, Western Pacific Ocean - 1
Northwestern mediterranean - 1
Northern Balearic Island - 1
"" - 2
Meditteranean - 1

```{r}
balticsea <- subset(ydata, country == "Baltic Sea", select = Title)
balticsea

```

